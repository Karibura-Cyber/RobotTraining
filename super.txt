#include <POP32.h>
int i = 3;

void setup() {
  oled.clear();
  oled.text(0,0,"READY");
  oled.show();

  waitSW_OK();
}

void loop() {
  // int deg = knob(0,180); 
  // oled.clear();
  // oled.text(0, 0, "%d", deg);
  // oled.show();
  // servo(1, deg);

  if(analog(2) < 1000){
    switch(i){
      case 1: r90(); lineb(); break;
      case 2: r90(); lineb(); break;
      case 3: r90(); lineb(); break;
      case 4: l90(); lineb(); break;
      case 5: AO(); sleep(100); shoot(); BK(50); sleep(450); AO(); sleep(10000); break;
    }
    i++;
  }
  else if(analog(0) < 1000){ FD2(70, 30); }
  else if(analog(4) < 1000){ FD2(30, 70); }
  else{ FD(50); sleep(1); }

  // check_sensor();
}

void lineb(){
  while(analog(5) > 1000 && analog(6) > 1000){
    BK(20); sleep(10);
    while(analog(5) < 1000 && analog(6) > 1000){
      BK2(0, 50); sleep(10);
      if(analog(5) < 1000 && analog(6) < 1000){break;}
    }
    while(analog(5) > 1000 && analog(6) < 1000){
      BK2(50, 0); sleep(10);
      if(analog(5) < 1000 && analog(6) < 1000){break;}
    }
  }
  AO(); sleep(100);
  FD(10); sleep(10);
}

void r90(){
  AO(); sleep(100);
  BK(50); sleep(200);
  AO(); sleep(100);
  SR(50); sleep(280);
}

void l90(){
  AO(); sleep(100);
  BK(50); sleep(200);
  AO(); sleep(100);
  SL(50); sleep(280);
}
void shoot(){
  servo(1, 38); delay(200);
  servo(1, 100); delay(200);
}
void check_sensor(){
  oled.clear();
  oled.text(0,0,"%d", analog(0));
  oled.text(1,0,"%d", analog(1));
  oled.text(2,0,"%d", analog(2));
  oled.text(3,0,"%d", analog(3));
  oled.text(4,0,"%d", analog(4));
  oled.show();
}
